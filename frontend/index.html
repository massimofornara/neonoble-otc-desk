<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NeoNoble OTC Off-Ramp – 1 NENO = 1000€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>NeoNoble Off-Ramp Desk</h1>
    <h2>1 $NENO = 1000 € – Volumi >€100M/giorno</h2>

    <div class="form">
      <input type="number" id="amount" placeholder="Quanti NENO" min="100000" step="1">
      <select id="receiveIn">
        <option value="EUR">Euro su IBAN</option>
        <option value="USDT">USDT</option>
        <option value="USDC">USDC</option>
        <option value="BTC">BTC</option>
        <option value="ETH">ETH</option>
        <option value="BNB">BNB</option>
        <option value="DAI">DAI</option>
        <option value="SOL">SOL</option>
      </select>
      <button onclick="getQuote()">Quotazione</button>
    </div>

    <div id="quote"></div>

    <div id="payment" style="display:none">
      <h3>Completa</h3>
      <input type="text" id="iban" placeholder="IBAN (default Unicredit)" style="display:none">
      <input type="text" id="wallet" placeholder="Wallet per crypto" style="display:none">
      <button onclick="executeTrade()">ESEGUI OFF-RAMP</button>
    </div>
  </div>

  <script>
    let quote = {};
    async function getQuote() {
      const amount = document.getElementById('amount').value;
      const receiveIn = document.getElementById('receiveIn').value;
      const res = await fetch('/api/otc/quote', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nenoAmount: Number(amount), receiveIn })
      });
      quote = await res.json();
      document.getElementById('quote').innerHTML = `
        <h3>Ricevi:</h3>
        <p>${receiveIn === 'EUR' ? quote.totalEur.toLocaleString() + ' €' : quote.cryptoAmount + ' ' + receiveIn}</p>
        <p>su ${receiveIn === 'EUR' ? 'IBAN Unicredit' : 'wallet'}</p>`;
      document.getElementById('payment').style.display = 'block';
      document.getElementById('iban').style.display = receiveIn === 'EUR' ? 'block' : 'none';
      document.getElementById('wallet').style.display = receiveIn !== 'EUR' ? 'block' : 'none';
      document.getElementById('iban').value = quote.defaultIban || '';
    }

    async function executeTrade() {
      const iban = document.getElementById('iban').value;
      const wallet = document.getElementById('wallet').value;
      const res = await fetch('/api/otc/execute', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ...quote, iban, walletAddress: wallet })
      });
      const data = await res.json();
      alert(data.success ? "OFF-RAMP COMPLETO! Fondi inviati." : data.error);
    }
  </script>
</body>
</html>
